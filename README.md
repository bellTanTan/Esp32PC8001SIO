# Esp32PC8001SIO

## 1.概要
NEC/PC-8001 SIO(DIP16 socket)に挿すゲタのハードとソフトです。ESP32とBME280を活用してSNTP/BME280情報取得/FTPリスト取得/FTP DL GETを行うことが出来ます。

![PC-8001装着状態](/img/009.jpg)

![拡張コマンド実行1](/img/010.jpg)

![拡張コマンド実行2](/img/011.jpg)

![拡張コマンド実行3](/img/012.jpg)

## 2.はじめに

2022年6月の「父の日」のプレゼントと称して息子夫婦/娘夫婦よりPC-8031-2W基板がプレゼントされて来ました。お父さんならこれを何かに活用できるだろうと言う目論見があったようです(草) 簡単に取り外すことが出来るICは死蔵保管とし基板にあったインバータロジックIC(SN74LS04)を2つ取り外して遥か昔に自作したNEC/PC-8001 SIO(DIP16 socket)ゲタでもちまちま作ってみるかと始めた結果です。

![PC-8031-2W基板](/img/004.jpg)

ここに来るまでに以下の形態をとって来ました。

第一形態はRS-232C D-SUB9(https://www.amazon.co.jp/gp/product/B00OPU2QJ4/ref=ppx_yo_dt_b_asin_title_o04_s00?ie=UTF8&psc=1)
![第一形態](/img/005.jpg)

第二形態はRS-232C D-SUB25(上記URLの極小RS232-TTLコンバータモジュールx2使用したD-SUB25シェル内2階建て配線物)
![第二形態](/img/006.jpg)

第三形態はフリスク基板 & ESP32-WROOM-32 bluetoothを活用したSerial←→bluetoothなブリッジ物
![第三形態](/img/007.jpg)

このリポジトリに記載するのは第四形態物になります。

![第四形態部品面](/img/013.jpg)

![第四形態はんだ面](/img/014.jpg)

## 3.出来ないこと

出来る事より出来ない事を優先します。このリポジトリを参考にして製作したあとで「あぁぁ、そうなんだ。それならイラね」「無駄な作業をさせやがって。ったく」と成らない為です(笑)

PC-8001本体のリセットスイッチでESP32-WROOM-32のリセット不可。不便なのは承知の上です。基板上の赤タクトスイッチを押して下さい。

PCG 8100との共存不可。SIO(DIP16 socket)とIC13(ユーザーROM/拡張ROMを挿すソケット)が干渉するためここで製作するSIOゲタと2764ROMゲタは利用不可。
![PCG8100装着状態](/img/008.jpg)

[PSA2.8a](http://fami-lan.net/parts/pcb.html)との共存不明。PSA2.8aは所有していない為、共存できるかわかりません。2022/09/10時点で見ると基板はまだ販売されているようなので近いうちに購入して確認してみたいところです。

その他PC-8001 CPUゲタ化装着する基板との共存不明。

その他外部化機器との共存不明。

小生の利用環境において根本的に外部バスと接続する機器で剥き出しな機器だと遊びに来てた小さい子が走り回って蹴ったり素手/濡手(自由に飲食するためｗ)で触ったり床/畳置きの場合につまづいて転倒したりした場合事故/怪我が想定されます。子供は電子機器に対しての基礎知識無いので自由人です(草) 明らかに素手/濡手で触っても感電/機器動作不良等を引き起こさないがっちりした筐体品なら外部化機器利用もありなのですがどうしても事故る/怪我する事を想定してしまうと設置に躊躇してしまいます。

またPC-8001外部バスの50ピンフラットケーブルは長いとノイズに弱い。ツイストペアでFGシールドなケーブルなら良いのですが無いものねだってもどうしようも無いです。PCG 8100以外の外部化機器はPC-8033しか所有していません。PC-8033があるのでPC-80S31経由でDisk利用可な環境ですが何せ物が40年超え品。磁気ヘッド補修なんて経験値ゼロ。5.25inch磁気ヘッドクリーニングキットも15年程前に使い切りました。5.25inch2Dメディアは今となっては新品購入不可。2Dメディア保管作業失敗するとメディア表面にカビが生えます。除去作業に失敗してメディア破損やら磁気ヘッド破損やら多々見て来ました(笑) いつ壊れても文句言えない製品のためDisk機器は特別な場合しか利用しないようにしています(笑)

## 4.最重要項目

元々公開する事を前提にしていませんでした。大切な過去資産/中古資産が作業内容によっては復旧不可能な破損状態になるかも知れません。このリポジトリを参考にして損害が発生しても一切保証出来ません。ご了承願います。

SIO Socket の端子図を示します

![SIOSocket端子図](/img/001.jpg)

+5/+12V/-12Vが出てきています。PC-8001通電中に短絡させると一発で機器破損する可能性あります。十分に注意して下さい。

関連するPC-8001の公開されている回路図を示します

![PC8001SIOCMT回路図](/img/000.jpg)

この回路図は工学社 I/O 1980年12月号または工学社 I/O別冊 PC-8001活用研究にて掲載された回路になります。インターネットアーカイブで公開されている[工学社 I/O別冊 PC-8001活用研究](https://archive.org/details/pc-8001_202108)より無断転載しました。手持ちPC-8001のSIO回路が断線無く繋がっている事をテスター等で十分に徹底確認して下さい。この時点でPC-8001側の回路導通不良があった場合は自ら補修するか別ハードを手に入れるか作業自体を諦めるかして下さい。

## 5.製作するゲタ回路図

SIOゲタの回路図を示します

![SIOゲタ回路図](/img/002.jpg)

74LS04 5A/6A がGND落ちてないのは気持ち悪いと思われる方はGNDへ落として下さい。パスコン入ってないのは気持ち悪いと思われる方は追加して下さい。手作業での手はんだ回路実装になるため配線不良(断線/短絡/はんだボイド等)でPC-8001側にダメージを与える事も予測されます。テスター等で十分に配線間違いが無いか導通確認を徹底して下さい。

細ピンヘッダは気持ち「ハの字」になるように斜めにブレッドボード等に差してはんだ付します。気持ち「ハの字」にするのはPC-8001本体をキーボード下にして本体ネジ締めのときゲタ落下防止の為です。

2764ROMゲタの回路図を示します

![2764ROMゲタ回路図](/img/003.jpg)

パスコン入ってないのは気持ち悪いと思われる方は追加して下さい。手作業での手はんだ回路実装になるため配線不良(断線/短絡/はんだボイド等)でPC-8001側にダメージを与える事も予測されます。十分にテスター等で配線間違いが無いか導通確認を徹底して下さい。

ピンヘッダは気持ち「ハの字」になるように斜めにブレッドボード等に差してはんだ付します。気持ち「ハの字」にするのはPC-8001本体をキーボード下にして本体ネジ締めのときゲタ落下防止の為です。ピンヘッダには分割ロングピンソケットを挿します。

![2764ROMゲタハの字](/img/032.jpg)

1990年代に秋葉原のジャンクBOXで購入したFC-80と言う手持ち2716ROMゲタを示します。

![FC80ゲタ実装面](/img/022.jpg)

![FC80ゲタはんだ面](/img/023.jpg)

遥か昔に自作したROMゲタ品は既に無いため今回はこの製品をお手本としました。IC13に挿すピン部品はJAE/PICD-12PB-T1と読めます。しかしこのピン部品は現在(2022/07/17時点)入手不可だった為ピンヘッダ(元々手持ち在庫資材)と分割ロングピンソケット(元々手持ち在庫資材)を繋ぎ合わせて2764ROMゲタ足としました。もっと適切な方法があればその方法で実装して下さい。PC-8001のキーボード裏基板と接触干渉しない。ROMゲタ装着時に他のICと接触干渉しない。これが目標になるROMゲタの製作と言う事です。

![PC8001キーボード裏](/img/021.jpg)

以下関連する実測寸法です。

FC-80ピン長 5.6mm

![FC80ゲタピン1](/img/024.jpg)

![FC80ゲタピン2](/img/025.jpg)

FC-80ピン全体長 10.7mm

![FC80ゲタ全体ピン1](/img/026.jpg)

![FC80ゲタ全体ピン2](/img/027.jpg)

2764ROMゲタピン長 3.0mm

![2764ROMゲタピン1](/img/030.jpg)

![2764ROMゲタピン2](/img/031.jpg)

2764ROMゲタ全体長 11.6mm

![2764ROMゲタ全体ピン1](/img/028.jpg)

![2764ROMゲタ全体ピン2](/img/029.jpg)

## 6.部品表
公開する事を前提に部品表を元々まとめていなかったため手持ち資材で購入元/品番が不明のものがあります。ご了承願います。

|部品番号|部品名|URL|数量|備考|
|----|----|----|----|----|
|CPU1|ESP32-WROOM-32|https://akizukidenshi.com/catalog/g/gM-11647/|1|新規に購入する場合は各種不具合改修されたD版以降が良いと思います|
|IC1|SN74LS04||1|PC-8031-2W基板から取り外して利用しました。中古購入だとヤフオク/各種電子部品取り扱いショップで探して下さい|
|IC2|2764 UVEPROM||1|手持ち品(NEC/uPD2764D)を使用しました。中古購入だとヤフオク/各種電子部品取り扱いショップで探して下さい|
|U1|AMS1117-3.3V 降圧型モジュール|https://www.amazon.co.jp/KKHMF-AMS1117-3-3-%E3%83%91%E3%83%AF%E3%83%BC%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB-AMS1117-3-3V-%E9%99%8D%E5%9C%A7%E5%9E%8B%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB/dp/B07FZ17B7D/ref=sr_1_6?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&keywords=AMS1117&qid=1663228485&sr=8-6|1|10セット品より動作確認して良さそうなのを選別して利用します。L字ピンは取り外して3ピンヘッダを取り付けて利用します|
|U2|BME280|https://www.amazon.co.jp/KKHMF-BME280%E6%B8%A9%E5%BA%A6%E3%82%BB%E3%83%B3%E3%82%B5-%E3%83%87%E3%82%B8%E3%82%BF%E3%83%AB%E3%83%96%E3%83%AC%E3%82%A4%E3%82%AF%E3%82%A2%E3%82%A6%E3%83%88IIC-5V%E6%B8%A9%E5%BA%A6%E3%82%BB%E3%83%B3%E3%82%B5-Arduino%E3%81%AB%E5%AF%BE%E5%BF%9C/dp/B088FLGGT8/ref=sr_1_7?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&keywords=BME280&linkCode=qs&qid=1663227828&sourceid=Mozilla-search&sr=8-7|1|BMP280(温度/気圧)を引き当てたらハズレと思って下さい。本来ならセンサ配置面のシルク印刷BMEの下にマークが入るはずです。マーク記載無し品として安くしているのかも知れません。BME280(温度/湿度/気圧)品販売なのにBMP280(温度/気圧)品混入が記載したURL以外のメーカー品であったような気がします|
|U3|AE-LCNV4-MOSFET|https://akizukidenshi.com/catalog/g/gK-13837/|1|ESP32側(3.3V)とPC-8001側(5V)とのTTLレベル変換に使用します|
|C1|小形アルミニウム電解コンデンサ 16V 100μF||1|
|C2|セラミックコンデンサ 50V 0.1uF||1|
|R1|1/6W 10kΩ||1|
|J1|細ピンヘッダ 1×40 (黒)|https://akizukidenshi.com/catalog/g/gC-06631/|1|8ピンx2としてSIOへ差すゲタで利用します|
|J2|ピンヘッダ 1x40|https://akizukidenshi.com/catalog/g/gC-00167/|1|12ピンx2としてIC13へ差すゲタで利用します。3ピンx1として5V降圧3.3Vモジュールで使用します|
|J3|分割ロングピンソケット 1x42|https://akizukidenshi.com/catalog/g/gC-05779/|1|12ピンx2としてIC13へ差すゲタで利用します|
|J4|ピンヘッダ (オスL型) 1x40|https://akizukidenshi.com/catalog/g/gC-01627/|1|1ピン、2ピンとしてESP32-WROOM-32のGND/TXD0/RXD0で利用します|
|S1|タクトスイッチ (赤色)|https://akizukidenshi.com/catalog/g/gP-03646/|1|ESP32-WROOM-32のRESET(EN)に利用します|
|S2|タクトスイッチ (黒色)|https://akizukidenshi.com/catalog/g/gP-03647/|1|ESP32-WROOM-32のFLASH(GPIO0)に利用します|
| |IC 16P ソケット||1|SIOゲタ上で74LS04装着に利用します|
| |IC 28P ソケット||1|2764ROMゲタ上で2764ROM装着に利用します|
| |ミンティア基板 for ESP-WROOM-32|https://www.amazon.co.jp/gp/product/B07SZLG6KL/ref=ppx_yo_dt_b_asin_title_o06_s00?ie=UTF8&psc=1|1|
| |両面ユニバーサル プリント基板||1|2764ROMゲタに利用します|

## 7.ESP32-WROOM-32へのファーム書き込み

準備中

## 8.2764ROM書き込み

準備中

## 9.SIOゲタ装着

準備中

## 10.2764ROMゲタ装着

準備中

## 11.PC-8001 SIO 通信速度設定

準備中

## 12.動作確認

準備中

## 13.PC-8001側拡張コマンド操作

準備中

## 14.最後に

準備中
